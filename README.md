# Descripttion
This is a repository for studying CircleCI personaly.<br>
If you have any suggestions, please raise an issue to discuss.

# Study plan(Japanese)
## ğŸ¯ ã‚´ãƒ¼ãƒ«è¨­å®š

1. **CircleCI ã®åŸºæœ¬æ§‹é€ ã¨æ¦‚å¿µ**ã‚’ç†è§£ã™ã‚‹ï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€ã‚¸ãƒ§ãƒ–ã€ã‚¹ãƒ†ãƒƒãƒ—ã€ã‚ªãƒ¼ãƒ–ãªã©ï¼‰
2. **`.circleci/config.yml` ã‚’è‡ªåŠ›ã§æ›¸ã‘ã‚‹**
3. **GitHub ãƒªãƒã‚¸ãƒˆãƒªã¨é€£æºã—ã€CI ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å‹•ã‹ã™**
4. å®Ÿå‹™ã§ä½¿ãˆã‚‹ãƒ¬ãƒ™ãƒ«ã®è¨­å®šï¼ˆãƒ†ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰ã‚’ä½œæˆ
5. ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨ãƒ‡ãƒãƒƒã‚°æ–¹æ³•ã‚’ç†è§£

---

## ğŸ“… 1é€±é–“ã®å­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| æ—¥ | é”æˆç›®æ¨™ | å‹‰å¼·å†…å®¹ | å‚è€ƒè³‡æ–™ | Done |
| --- | --- | --- | --- | --- |
| **Day 1** | CircleCI ã®å…¨ä½“åƒã¨ç”¨èªã‚’ç†è§£ | - CircleCI ã®å½¹å‰²ã¨CI/CDã®åŸºç¤ - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ»ã‚¸ãƒ§ãƒ–ãƒ»ã‚¹ãƒ†ãƒƒãƒ—ãƒ»ã‚ªãƒ¼ãƒ–ã®æ¦‚å¿µ - GitHubé€£æºã®æµã‚Œ | å…¬å¼æ¦‚è¦ å…¬å¼ç”¨èªé›† | âœ… |
| **Day 2** | æœ€å°æ§‹æˆã® `.circleci/config.yml` ã‚’æ›¸ã | - `version`, `jobs`, `steps` ã®åŸºæœ¬æ§‹é€ - Hello World ãƒ“ãƒ«ãƒ‰ã‚’ä½œæˆã—ã€GitHub ã« push â†’ å®Ÿè¡Œ- Web UI ã®ã‚¸ãƒ§ãƒ–çµæœã®è¦‹æ–¹ | Config ã®æ›¸ãæ–¹ | âœ… |
| **Day 3** | å®Ÿå‹™çš„ãªãƒ†ã‚¹ãƒˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä½œæˆ | - Node.js / Python ãªã©ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä½œæˆ - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä½¿ã„æ–¹ - `.env` ã‚„ secrets ã®è¨­å®š | ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š ç’°å¢ƒå¤‰æ•° | âœ… |
| **Day 4** | ä¸¦åˆ—å®Ÿè¡Œã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã‚’å­¦ã¶ | - è¤‡æ•°ã‚¸ãƒ§ãƒ–ã®ä¸¦åˆ—å®Ÿè¡Œ - `requires` ã«ã‚ˆã‚‹ä¾å­˜åˆ¶å¾¡ - æ¡ä»¶åˆ†å²ï¼ˆfilters / branchï¼‰ | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š | âœ… |
| **Day 5** | ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã®è¿½åŠ  | - ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¸ãƒ§ãƒ–ã®ä½œæˆï¼ˆä¾‹: GitHub Pages / AWS S3 / Vercelï¼‰ - ã‚ªãƒ¼ãƒ–ã‚’ä½¿ã£ãŸãƒ‡ãƒ—ãƒ­ã‚¤ç°¡ç•¥åŒ– | Orbsã®ä½¿ã„æ–¹ | âœ… |
| **Day 6** | ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»æœ€é©åŒ– | - ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ï¼ˆãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ãƒ‘ã‚¹å•é¡Œï¼‰ - å†å®Ÿè¡Œãƒ»SSHãƒ‡ãƒãƒƒã‚°æ–¹æ³•- å®Ÿè¡Œæ™‚é–“çŸ­ç¸®ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ | ãƒ‡ãƒãƒƒã‚°æ–¹æ³• | âœ… |
| **Day 7** | ç·åˆæ¼”ç¿’ | - å°è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’GitHubã«ä½œã‚Šã€ãƒ†ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã‚’è‡ªå‹•åŒ– - ãƒ—ãƒ«ãƒªã‚¯ä½œæˆ â†’ è‡ªå‹•ãƒ†ã‚¹ãƒˆ â†’ ãƒ‡ãƒ—ãƒ­ã‚¤ã®ä¸€é€£ã®æµã‚Œã‚’å®Œæˆ | ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé›† | âœ… |

## Day 1âœ…

## CI/CD ã¨ã¯ï¼Ÿ

CI/CD ã¨ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚„ã‚¢ãƒ—ãƒªé–‹ç™ºã«ã¯æ¬ ã‹ã›ãªã„ é–‹ç™ºæ‰‹æ³•ã®ä¸€ã¤ã§ã‚ã‚Šæ—¥æœ¬èªã§ã¯ã€Œç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼†ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼ã€ã€è‹±èªã§ã¯ã€Œ**Continuous Integrationãƒ»CI / Continuous Deliveryãƒ»CD**ã€äºŒã¤ã®è¨€è‘‰ã‚’ä¸€ã¤ã«ç•¥ã—ã¦ã€Œ**CI/CD**ã€ã¨ç•¥ã—ã¾ã™ã€‚CI/CDã‚’é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã«å°å…¥ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªãƒã‚§ãƒƒã‚¯ã¯ã‚‚ã¡ã‚ã‚“ã€ãƒã‚°ã®ç™ºè¦‹ã€ãƒ†ã‚¹ãƒˆã®è‡ªå‹•åŒ–ã€è‡ªå‹•åŒ–ãƒ‡ãƒªãƒãƒªãƒ¼ã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãŒå®Ÿç¾ã—ã€é–‹ç™ºè€…ã‚„ãƒãƒ¼ãƒ å…¨ä½“ã®ç”Ÿç”£æ€§ã®å‘ä¸Šã«ã‚‚éå¸¸ã«åŠ¹æœãŒã‚ã‚‹ã¨çŸ¥ã‚‰ã‚Œã¦ã„ã‚‹é–‹ç™ºæ‰‹æ³•ã§ã™ã€‚
Reference: https://circleci.com/ja/blog/what-is-ci-cd/

### CircleCI ã®å½¹å‰²ã¨CI/CDã®åŸºç¤- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ»ã‚¸ãƒ§ãƒ–ãƒ»ã‚¹ãƒ†ãƒƒãƒ—ãƒ»ã‚ªãƒ¼ãƒ–ã®æ¦‚å¿µ

1. **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ (Pipeline)**
    
    ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã€CircleCIã«ãŠã‘ã‚‹**ä¸€é€£ã®ãƒ—ãƒ­ã‚»ã‚¹ã®å…¨ä½“åƒ**ã‚’è¡¨ã—ã¾ã™ã€‚é€šå¸¸ã€GitHubã‚„Bitbucketã®ãƒªãƒã‚¸ãƒˆãƒªã¸ã®ã‚³ãƒ¼ãƒ‰ã®`push`ãªã©ã‚’ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦é–‹å§‹ã•ã‚Œã¾ã™ã€‚1ã¤ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã€1ã¤ä»¥ä¸Šã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚
    
2. **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (Workflow)**
    
    ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã§å®Ÿè¡Œã•ã‚Œã‚‹**ã‚¸ãƒ§ãƒ–ã®å®Ÿè¡Œé †åºã‚„ä¾å­˜é–¢ä¿‚ã‚’å®šç¾©**ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ä¾‹ãˆã°ã€ã€Œãƒ“ãƒ«ãƒ‰ã‚¸ãƒ§ãƒ–ãŒæˆåŠŸã—ãŸã‚‰ã€ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ã€ãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–ã‚‚æˆåŠŸã—ãŸã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹ã€ã¨ã„ã£ãŸæµã‚Œã‚’å®šç¾©ã§ãã¾ã™ã€‚ã‚¸ãƒ§ãƒ–ã‚’ä¸¦åˆ—ã«å®Ÿè¡Œã—ãŸã‚Šã€ç‰¹å®šã®ãƒ–ãƒ©ãƒ³ãƒã§ã®ã¿å®Ÿè¡Œã—ãŸã‚Šã¨ã„ã£ãŸåˆ¶å¾¡ã‚‚å¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¤‡é›‘ãªãƒ—ãƒ­ã‚»ã‚¹ã‚‚åŠ¹ç‡çš„ã«ç®¡ç†ã§ãã¾ã™ã€‚
    
3. **ã‚¸ãƒ§ãƒ– (Job)**
    
    ã‚¸ãƒ§ãƒ–ã¯ã€**ç‰¹å®šã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹å˜ä½**ã§ã™ã€‚ä¾‹ãˆã°ã€ã€Œã‚³ãƒ¼ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ã€ã€Œå˜ä½“ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã€ã€ŒDockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã€ã€Œã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€ãªã©ãŒãã‚Œãã‚Œã‚¸ãƒ§ãƒ–ã¨ã—ã¦å®šç¾©ã•ã‚Œã¾ã™ã€‚å„ã‚¸ãƒ§ãƒ–ã¯ã€æŒ‡å®šã•ã‚ŒãŸExecutorï¼ˆå®Ÿè¡Œç’°å¢ƒï¼‰ä¸Šã§ã€ä¸€é€£ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
    
4. **ã‚¹ãƒ†ãƒƒãƒ— (Step)**
    
    ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€ã‚¸ãƒ§ãƒ–å†…ã§å®Ÿè¡Œã•ã‚Œã‚‹**å€‹ã€…ã®ã‚³ãƒãƒ³ãƒ‰ã‚„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**ã§ã™ã€‚ã‚·ã‚§ãƒ«ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹`run`ã‚¹ãƒ†ãƒƒãƒ—ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã™ã‚‹`checkout`ã‚¹ãƒ†ãƒƒãƒ—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿å­˜ãƒ»å¾©å…ƒã™ã‚‹`save_cache`/`restore_cache`ã‚¹ãƒ†ãƒƒãƒ—ãªã©ã€æ§˜ã€…ãªç¨®é¡ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
    
5. **Executor (å®Ÿè¡Œç’°å¢ƒ)**
    
    Executorã¯ã€**ã‚¸ãƒ§ãƒ–ãŒå®Ÿè¡Œã•ã‚Œã‚‹ç’°å¢ƒ**ã‚’æŒ‡å®šã—ã¾ã™ã€‚CircleCIã§ã¯ã€ä¸»ã«ä»¥ä¸‹ã®ExecutorãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚
    
    - `docker`: æŒ‡å®šã—ãŸDockerã‚¤ãƒ¡ãƒ¼ã‚¸å†…ã§ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚æœ€ã‚‚ä¸€èˆ¬çš„ã«åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚
    - `machine`: Linux, Windows, macOS ã®ä»®æƒ³ãƒã‚·ãƒ³ä¸Šã§ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚DockerãŒåˆ©ç”¨ã§ããªã„å ´åˆã‚„ã€ã‚ˆã‚Šå¤šãã®ãƒªã‚½ãƒ¼ã‚¹ãŒå¿…è¦ãªå ´åˆã«ä½¿ç”¨ã—ã¾ã™ã€‚
    - `macos`: macOSã‚¢ãƒ—ãƒªã®é–‹ç™ºãªã©ã€macOSç’°å¢ƒãŒå¿…è¦ãªå ´åˆã«ä½¿ç”¨ã—ã¾ã™ã€‚
    
    ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦ä»¶ã«åˆã‚ã›ã¦é©åˆ‡ãªExecutorã‚’é¸æŠã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
    
6. **ã‚ªãƒ¼ãƒ– (Orb)**
    
    ã‚ªãƒ¼ãƒ–ã¯ã€**å†åˆ©ç”¨å¯èƒ½ãªè¨­å®šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**ã§ã™ã€‚ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚¿ã‚¹ã‚¯ï¼ˆä¾‹: AWSã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€Slackã¸ã®é€šçŸ¥ã€ç‰¹å®šã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ãƒ†ã‚¹ãƒˆè¨­å®šï¼‰ãŒã‚ªãƒ¼ãƒ–ã¨ã—ã¦æä¾›ã•ã‚Œã¦ãŠã‚Šã€`config.yml`ã«æ•°è¡Œè¿½åŠ ã™ã‚‹ã ã‘ã§ç°¡å˜ã«åˆ©ç”¨ã§ãã¾ã™ã€‚è‡ªåˆ†ã§ã‚ªãƒ¼ãƒ–ã‚’ä½œæˆã—ã¦å…±æœ‰ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è¨˜è¿°é‡ã‚’å‰Šæ¸›ã—ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
    Reference: https://omomuki-tech.com/archives/182
    

## Day2âœ…

## Config ã®æ›¸ãæ–¹

```yaml
version: 2.1

jobs:
  say-hello:
    docker:
      - image: cimg/base:stable
    steps:
      - run: echo "Hello, CircleCI!"

workflows:
  main:
    jobs:
      - say-hello
```

- `version: 2.1`: CircleCIã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚æœ€æ–°ã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«`2.1`ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
- `jobs`: å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ã‚¸ãƒ§ãƒ–ã®ãƒªã‚¹ãƒˆã‚’å®šç¾©ã—ã¾ã™ã€‚
- `say-hello`:Â `jobs`ã®ä¸­ã«å®šç¾©ã•ã‚ŒãŸã‚¸ãƒ§ãƒ–ã®åå‰ã§ã™ã€‚
- `docker: - image: cimg/base:stable`: ã“ã®ã‚¸ãƒ§ãƒ–ãŒ`cimg/base:stable`ã¨ã„ã†Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯CircleCIãŒæä¾›ã™ã‚‹æ±ç”¨ã®Linuxç’°å¢ƒã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚
- `steps`: ã‚¸ãƒ§ãƒ–å†…ã§å®Ÿè¡Œã•ã‚Œã‚‹å…·ä½“çš„ãªæ‰‹é †ã®ãƒªã‚¹ãƒˆã§ã™ã€‚
- `run: echo "Hello, CircleCI! "`: ã‚·ã‚§ãƒ«ã§`echo`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€â€Hello, CircleCI! â€ã¨ã„ã†æ–‡å­—åˆ—ã‚’å‡ºåŠ›ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚
- `workflows`: ã©ã®ã‚¸ãƒ§ãƒ–ã‚’ã©ã®é †åºã§å®Ÿè¡Œã™ã‚‹ã‹ã‚’å®šç¾©ã—ã¾ã™ã€‚
- `main`: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®åå‰ã§ã™ã€‚
- `jobs: - say-hello`:Â `main`ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã¯ã€`say-hello`ã¨ã„ã†ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

## Day3âœ…

### Node.js / Python ãªã©ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä½œæˆ

Node.js

`npx create-next-app circlecitestapp` 

`npm run lint`

```yaml
version: 2.2

jobs:
  build:
    docker:
      - image: cimg/node:20.10
      # Node.js å…¬å¼ CircleCI ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«åˆã‚ã›ã‚‹ï¼‰
    working_directory: ~/repo

    steps:
      - checkout
      # ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
      - restore_cache:
          keys:
            - v1-deps-{{ checksum "circlecitestapp/package-lock.json" }}
            - v1-deps-
      - run:
          name: Install dependencies
          command: |
            cd circlecitestapp
            npm ci
      - save_cache:
          paths:
            - ~/.npm
          key: v1-deps-{{ checksum "circlecitestapp/package-lock.json" }}
      - run:
          name: Run lint
          command: |
            cd circlecitestapp
            npm run lint
      - run:
          name: Build Next.js app
          command: |
            cd circlecitestapp
            npm run build

workflows:
  version: 2
  build_and_test:
    jobs:
      - build
```

- **`cimg/node:20.10`**
    - CircleCI ãŒæä¾›ã™ã‚‹å…¬å¼ Node.js ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã€‚
    - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `package.json` ã«åˆã‚ã›ã¦ Node ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨ã‚ˆã„ã§ã™ã€‚
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (`restore_cache` / `save_cache`)**
    - `package-lock.json` ã® checksum ã‚’ã‚­ãƒ¼ã«ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã“ã¨ã§ã€ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é«˜é€ŸåŒ–ã§ãã¾ã™ã€‚
- **`npm ci`**
    - å†ç¾æ€§ã®ã‚ã‚‹ã‚¯ãƒªãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚CI/CD ã§ã¯ `npm install` ã‚ˆã‚Šæ¨å¥¨ã€‚
- **ãƒ†ã‚¹ãƒˆ â†’ ãƒ“ãƒ«ãƒ‰ã®é †åº**
    - `npm test` ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ†ã‚¹ãƒˆãŒãªã„ã®ã§å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ã‚ã‚Šã€‚
    - ã‚‚ã—ã¾ã ãƒ†ã‚¹ãƒˆã‚’ç”¨æ„ã—ã¦ã„ãªã‘ã‚Œã°ã€`npm test` ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ä¸€æ—¦ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ OKã€‚
- **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (`workflows`)**
    - CircleCI ã¯ã‚¸ãƒ§ãƒ–å˜ä½“ã§ã‚‚å‹•ã‹ã›ã¾ã™ãŒã€å®Ÿå‹™ã§ã¯ `workflows` ã§åˆ¶å¾¡ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã€‚

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä½¿ã„æ–¹

- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (`restore_cache` / `save_cache`)**
    - `package-lock.json` ã® checksum ã‚’ã‚­ãƒ¼ã«ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã“ã¨ã§ã€ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é«˜é€ŸåŒ–ã§ãã¾ã™ã€‚
    - `v1-deps` : ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
    `v1` : ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ `v2` ãªã©ã«æ›¸ãæ›ãˆã‚‹ã¨ä¸Šæ›¸ãã•ã‚Œã‚‹
    `deps` : dependenciesï¼ˆä¾å­˜é–¢ä¿‚ï¼‰ ã®ç•¥

Reference: [Caching dependencies :: CircleCI Documentation](https://circleci.com/docs/guides/optimize/caching/)

## Day4âœ…

## è¤‡æ•°ã‚¸ãƒ§ãƒ–ã®ä¸¦åˆ—å®Ÿè¡Œ

### `requires`

```yaml
workflows:
  version: 2
  build-deploy:
    jobs:
      - build-python
      - build-next
      - deploy:
          requires:
            - build-python
            - build-next
```

`build-python` ã¨ `build-next` ã¯ **ä¸¦åˆ—å®Ÿè¡Œ**ã•ã‚Œã€ä¸¡æ–¹ãŒçµ‚ã‚ã£ã¦ã‹ã‚‰ `deploy` ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚

### æ¡ä»¶åˆ†å²ï¼ˆfilters / branchï¼‰

```yaml
workflows:
  version: 2
  build-deploy:
    jobs:
      - build
      - deploy:
          requires:
            - build
          filters:
            branches:
              only: main
```

- `build` ã¯å…¨ãƒ–ãƒ©ãƒ³ãƒã§å®Ÿè¡Œ
- `deploy` ã¯ **main ãƒ–ãƒ©ãƒ³ãƒã« push ã•ã‚ŒãŸã¨ãã ã‘**å®Ÿè¡Œ

## Day5âœ…

## ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¸ãƒ§ãƒ–ã®ä½œæˆ

### GitHub Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤

```yaml
version: 2.1

jobs:
  build:
    docker:
      - image: cimg/node:20.12
    steps:
      - checkout
      - run: npm install
      - run: npm run build
      - run: npm run export
      - persist_to_workspace:
          root: .
          paths:
            - out

  deploy-ghpages:
    docker:
      - image: cimg/node:20.12
    steps:
      - attach_workspace:
          at: .
      - run:
          name: Install gh-pages
          command: npm install -g gh-pages
      - run:
          name: Deploy to GitHub Pages
          command: gh-pages -d out -r https://$GITHUB_TOKEN@github.com/USERNAME/REPO.git

workflows:
  version: 2
  deploy:
    jobs:
      - build
      - deploy-ghpages:
          requires:
            - build
          filters:
            branches:
              only: main
```

- `$GITHUB_TOKEN` ã¯ **CircleCI ã® Project Settings â†’ Environment Variables** ã§è¨­å®šã™ã‚‹
- `gh-pages` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ `out/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ `gh-pages` ãƒ–ãƒ©ãƒ³ãƒã¸ push

### Vercel ã«ãƒ‡ãƒ—ãƒ­ã‚¤

```yaml
jobs:
  deploy-vercel:
    docker:
      - image: cimg/node:20.12
    steps:
      - checkout
      - run: npm install -g vercel
      - run:
          name: Deploy to Vercel
          command: vercel --prod --token $VERCEL_TOKEN
```

- `$VERCEL_TOKEN` ã‚’ Vercel ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰ç™ºè¡Œ â†’ CircleCI ã®ç’°å¢ƒå¤‰æ•°ã«ç™»éŒ²
- `vercel.json` ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«ç½®ã„ã¦ãŠãã¨è¨­å®šãŒå®‰å®šã™ã‚‹

## ã‚ªãƒ¼ãƒ–ã‚’ä½¿ã£ãŸãƒ‡ãƒ—ãƒ­ã‚¤ç°¡ç•¥åŒ–

### GitHub Pages Orb ã‚’ä½¿ã£ãŸãƒ‡ãƒ—ãƒ­ã‚¤

```yaml
version: 2.1

orbs:
  gh-pages: circleci/gh-pages@1.2.0

workflows:
  deploy:
    jobs:
      - gh-pages/deploy:
          setup: npm ci && npm run build && npm run export
          publish-dir: out
          repo: USERNAME/REPO
          git-username: CircleCI
          git-email: ci@example.com
          token: GITHUB_TOKEN
          filters:
            branches:
              only: main
```

- Orb ãŒè‡ªå‹•çš„ã« `gh-pages` ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã‚Œã‚‹
- `publish-dir: out` ã‚’ Next.js ã® export å‡ºåŠ›å…ˆã«æŒ‡å®š
- `GITHUB_TOKEN` ã‚’ CircleCI ã®ç’°å¢ƒå¤‰æ•°ã«ç™»éŒ²ã—ã¦ãŠã

### Vercel Orb ã¯å­˜åœ¨ã—ãªã„ï¼ˆãŒä»£æ›¿ã¯å¯èƒ½ï¼‰

ã‚·ãƒ³ãƒ—ãƒ«ã« `Vercel CLI` ã‚’å‘¼ã¶

ã‚‚ã— Orb ã£ã½ãç°¡ç•¥åŒ–ã—ãŸã„ãªã‚‰ `commands:` ã‚’è‡ªä½œã—ã¦å†åˆ©ç”¨

```yaml
commands:
  deploy-vercel:
    steps:
      - run: npm install -g vercel
      - run: vercel --prod --token $VERCEL_TOKEN
```

## Day 6âœ…

## ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼

### ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆå´©ã‚Œ

```yaml
      - run:
          name: Run script
```

### CircleCI ã® YAML ã‚¹ã‚­ãƒ¼ãƒã«åˆã‚ãªã„æ›¸ãæ–¹

ã‚¨ãƒ©ãƒ¼ï¼š

```
ERROR IN CONFIG FILE: 
[#/jobs/build] 0 subschemas matched instead of one 1. 
[#/jobs/build] only 1 subschema matches out of 2
```

å•é¡Œç™ºç”Ÿç®‡æ‰€ï¼š

```yaml
workflows:
  version: 2
  build:
    jobs:
      - build
```

âœ… ä¿®æ­£ã—ãŸæ­£ã—ã„å½¢ï¼š

```yaml
workflows:
  version: 2
  ci_pipeline:
    jobs:
      - build
```

### next lint ãŒåˆå›å®Ÿè¡Œæ™‚ã«å¯¾è©±å¼ã§ ESLint è¨­å®šã‚’ä½œã‚ã†ã¨ã™ã‚‹

ã‚¨ãƒ©ãƒ¼ï¼š

```
> circlecitestapp@0.1.0 lint 
> next lint 

? How would you like to configure ESLint? 
https://nextjs.org/docs/app/api-reference/config/eslint 
â¯ Strict (recommended) 
Base 
Cancel 

Too long with no output (exceeded 10m0s): context deadline exceeded
```

âœ… è§£æ±ºç­–: 

ãƒ­ãƒ¼ã‚«ãƒ«ã§ ESLint è¨­å®šã‚’ç”Ÿæˆã—ã¦ã‚³ãƒŸãƒƒãƒˆ

```bash
npm run lint
```

### Python ä»®æƒ³ç’°å¢ƒã®ä½œã‚Šæ–¹

- CircleCI ã® Linux ã‚³ãƒ³ãƒ†ãƒŠã§ã¯ Windows ã® `Scripts/activate` ã¯å­˜åœ¨ã—ã¾ã›ã‚“ï¼ˆãã‚Œã¯ Windows ç’°å¢ƒå°‚ç”¨ã®ãƒ‘ã‚¹ã§ã™ï¼‰ã€‚
- CircleCI ã® Linux ç’°å¢ƒã§ã¯ `venv/bin/activate` ã‚’ä½¿ã†ã®ãŒæ­£è§£ã§ã™ã€‚

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å¯¾è±¡

- `~/.pip` ã§ã¯ãªãã€pip ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ `~/.cache/pip` ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
- ä¾å­˜é–¢ä¿‚ã®å†åˆ©ç”¨ã‚’ã—ãŸã„ãªã‚‰ã“ã£ã¡ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚

### `version:` ã®å€¤

- CircleCI ã® `version:` ã¯ **2.1 ã‹ 2.0** ãŒæ¨å¥¨ã§ã™ï¼ˆ2.3 ã‚„ 3 ã¯å­˜åœ¨ã—ã¾ã›ã‚“ï¼‰ã€‚
- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã® `version:` ã‚‚åŒæ§˜ã« `2` ã‚’æ›¸ãã¾ã™ã€‚

## Day7âœ…

## å†å®Ÿè¡Œãƒ»SSHãƒ‡ãƒãƒƒã‚°æ–¹æ³•- å®Ÿè¡Œæ™‚é–“çŸ­ç¸®ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### âœ… å†å®Ÿè¡Œï¼ˆRerunï¼‰

- **CircleCI ã® Web UI** â†’ `Workflows` â†’ è©²å½“ã®ã‚¸ãƒ§ãƒ–ã§ã€ŒRerunã€ã‚’é¸æŠå¯èƒ½
- ã‚ªãƒ—ã‚·ãƒ§ãƒ³:
    - **Rerun Job**: ãã®ã‚¸ãƒ§ãƒ–ã ã‘å†å®Ÿè¡Œ
    - **Rerun Workflow from failed**: å¤±æ•—ã—ãŸã‚¸ãƒ§ãƒ–ä»¥é™ã‚’å†å®Ÿè¡Œ
    - **Rerun from beginning**: å…¨ã‚¸ãƒ§ãƒ–ã‚’å†å®Ÿè¡Œ

ğŸ’¡ ç‰¹ã«ä¾å­˜é–¢ä¿‚ãŒã‚ã‚‹å ´åˆã¯ `from failed` ãŒä¾¿åˆ©ã§ã™ã€‚

### âœ… SSH ãƒ‡ãƒãƒƒã‚°

CircleCI ã§ã¯ã‚¸ãƒ§ãƒ–ã‚’ **SSH ä»˜ãã§å†å®Ÿè¡Œ**ã§ãã¾ã™ã€‚

- UI ã‹ã‚‰ã€ŒRerun job with SSHã€ã‚’é¸æŠ
- æ•°åˆ†å¾Œã« SSH æ¥ç¶šæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ãƒ­ãƒ¼ã‚«ãƒ«ã§:
    
    ```bash
    ssh -p <PORT> <USER>@<IP>
    ```
    
- ãã®ç’°å¢ƒã«å…¥ã£ã¦ `ls`, `cat config.yml`, `npm run build` ãªã©ã‚’ç›´æ¥å®Ÿè¡Œã—ã¦èª¿æŸ»å¯èƒ½

ğŸ’¡ `~/project` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ãŒã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã€`~/` ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã©ãŒã‚ã‚Šã¾ã™ã€‚

# ğŸ”¹ å®Ÿè¡Œæ™‚é–“çŸ­ç¸®ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®é©åˆ‡åˆ©ç”¨**
    - `restore_cache` / `save_cache` ã‚’ä½¿ã„ã€ä¾å­˜é–¢ä¿‚ã‚’å†åˆ©ç”¨
    - ä¾‹ï¼ˆPython/Pipï¼‰:
        
        ```yaml
        - restore_cache:
            keys:
              - deps-{{ checksum "requirements.txt" }}
              - deps-
        - run: pip install -r requirements.txt
        - save_cache:
            key: deps-{{ checksum "requirements.txt" }}
            paths:
              - ~/.cache/pip
        ```
        
    - ä¾‹ï¼ˆNode/NPMï¼‰:
        
        ```yaml
        - restore_cache:
            keys:
              - npm-deps-{{ checksum "package-lock.json" }}
              - npm-deps-
        - run: npm ci
        - save_cache:
            key: npm-deps-{{ checksum "package-lock.json" }}
            paths:
              - ~/.npm
        ```
        
2. **ä¾å­˜é–¢ä¿‚ã®å›ºå®š**
    - `pip install -r requirements.txt` ã®ä»£ã‚ã‚Šã« **lock ãƒ•ã‚¡ã‚¤ãƒ«**ã‚’ä½¿ã†
    - Node ãªã‚‰ `npm ci` ã‚’æ¨å¥¨ï¼ˆ`npm install` ã‚ˆã‚Šé«˜é€Ÿã§å†ç¾æ€§ã‚ã‚Šï¼‰
3. **ã‚¸ãƒ§ãƒ–ã®ä¸¦åˆ—åŒ–**
    - `parallelism: 4` ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹ã¨ãƒ†ã‚¹ãƒˆã‚’åˆ†å‰²ã§ãã‚‹
    - ä¾‹:
        
        ```yaml
        jobs:
          test:
            docker:
              - image: cimg/python:3.11
            parallelism: 4
            steps:
              - checkout
              - run: pytest --maxfail=1 --disable-warnings -q
        ```
        
4. **ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®æ´»ç”¨**
    - ã‚ã‚‹ã‚¸ãƒ§ãƒ–ã§ãƒ“ãƒ«ãƒ‰ã—ãŸæˆæœç‰©ã‚’ã€æ¬¡ã®ã‚¸ãƒ§ãƒ–ã§å†åˆ©ç”¨å¯èƒ½
    - ä¾‹:
        
        ```yaml
        - persist_to_workspace:
            root: .
            paths:
              - build
        - attach_workspace:
            at: .
        ```
        
5. **ä¸è¦ãªã‚¹ãƒ†ãƒƒãƒ—ã‚’å‰Šã‚‹**
    - `npm run lint` ã‚„ `pytest` ã‚’ main ãƒ–ãƒ©ãƒ³ãƒã®ã¿å®Ÿè¡Œ
    - `filters:` ã‚’æ´»ç”¨ã—ã¦ PR æ™‚ã¯æœ€å°é™ã®ãƒã‚§ãƒƒã‚¯ã ã‘ã«ã™ã‚‹
6. **Docker ã‚¤ãƒ¡ãƒ¼ã‚¸é¸ã³**
    - `cimg/node:20.12` ãªã© CircleCI ã®æœ€é©åŒ–æ¸ˆã¿ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ã†
    - ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯è‡ªç”±åº¦ãŒé«˜ã„ãŒèµ·å‹•ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆã‚ã‚Š
